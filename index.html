<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winter Olympics 2026 - Draft Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h2 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #667eea;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .competitor-name {
            font-weight: 600;
            color: #667eea;
        }

        .medal-input {
            width: 50px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .gold { color: #FFD700; font-weight: bold; }
        .silver { color: #C0C0C0; font-weight: bold; }
        .bronze { color: #CD7F32; font-weight: bold; }

        .score {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .rank-1 { background: #FFD70020; }
        .rank-2 { background: #C0C0C020; }
        .rank-3 { background: #CD7F3220; }

        .bonus {
            background: #4ade80;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .update-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
            width: 100%;
        }

        .update-btn:hover {
            background: #5568d3;
        }

        .leaderboard-row {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 5px solid #667eea;
        }

        .leaderboard-name {
            font-weight: 600;
            font-size: 1.1em;
        }

        .leaderboard-score {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 968px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .table-container {
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .wiki-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        .wiki-btn:hover {
            background: #059669;
        }

        .wiki-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .status.loading {
            background: #fef3c7;
            color: #92400e;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèîÔ∏è Winter Olympics 2026 - Draft Game ü•á</h1>

        <div class="layout">
            <div class="card">
                <h2>Country Standings & Medal Count</h2>
                <div class="table-container">
                    <table id="countryTable">
                        <thead>
                            <tr>
                                <th>Competitor</th>
                                <th>Country</th>
                                <th class="gold">ü•á Gold (5pt)</th>
                                <th class="silver">ü•à Silver (3pt)</th>
                                <th class="bronze">ü•â Bronze (2pt)</th>
                                <th>Total Medals</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="countryBody">
                        </tbody>
                    </table>
                </div>
                <div class="btn-group">
                    <button class="wiki-btn" onclick="fetchWikipediaData()" id="wikiBtn">üì° Update from Wikipedia</button>
                    <button class="update-btn" onclick="calculateScores()">üîÑ Recalculate Scores</button>
                </div>
                <div id="status" class="status hidden"></div>
            </div>

            <div class="card">
                <h2>üèÜ Leaderboard</h2>
                <div id="leaderboard"></div>
            </div>
        </div>
    </div>

    <script>
        const draftData = [
            { competitor: 'Kory', countries: ['Norway', 'Hungary', 'Denmark'] },
            { competitor: 'Cole', countries: ['Germany', 'New Zealand', 'Spain'] },
            { competitor: 'Buck', countries: ['Finland', 'Belgium', 'Croatia'] },
            { competitor: 'Del', countries: ['Canada', 'Australia', 'Latvia'] },
            { competitor: 'Steve', countries: ['USA', 'Slovenia', 'Estonia'] },
            { competitor: 'CP', countries: ['Netherlands', 'Slovakia', 'Ukraine'] },
            { competitor: 'Doug', countries: ['France', 'Individual Neutral Athletes', 'Brazil'] },
            { competitor: 'Beav', countries: ['Switzerland', 'Poland', 'Lithuania'] },
            { competitor: 'John', countries: ['Austria', 'Great Britain', 'Kazakhstan'] },
            { competitor: 'Dunn', countries: ['Italy', 'Sweden', 'Romania'] },
            { competitor: 'KJ', countries: ['China', 'Czech Republic', 'Bulgaria'] },
            { competitor: 'Rob', countries: ['Japan', 'South Korea', 'Turkey'] }
        ];

        let medalData = {
            'Norway': { gold: 1, silver: 1, bronze: 1 },
            'Italy': { gold: 1, silver: 1, bronze: 1 },
            'Japan': { gold: 1, silver: 1, bronze: 1 },
            'Switzerland': { gold: 1, silver: 0, bronze: 0 },
            'Sweden': { gold: 1, silver: 1, bronze: 0 },
            'Canada': { gold: 0, silver: 0, bronze: 1 },
            'China': { gold: 0, silver: 0, bronze: 1 },
            'Slovenia': { gold: 0, silver: 1, bronze: 0 }
        };

        function initializeTable() {
            const tbody = document.getElementById('countryBody');
            tbody.innerHTML = '';

            draftData.forEach(player => {
                player.countries.forEach(country => {
                    const medals = medalData[country] || { gold: 0, silver: 0, bronze: 0 };
                    const row = tbody.insertRow();

                    row.innerHTML = `
                        <td class="competitor-name">${player.competitor}</td>
                        <td>${country}</td>
                        <td><input type="number" class="medal-input gold" value="${medals.gold}" min="0" data-country="${country}" data-medal="gold"></td>
                        <td><input type="number" class="medal-input silver" value="${medals.silver}" min="0" data-country="${country}" data-medal="silver"></td>
                        <td><input type="number" class="medal-input bronze" value="${medals.bronze}" min="0" data-country="${country}" data-medal="bronze"></td>
                        <td id="total-${country}">${medals.gold + medals.silver + medals.bronze}</td>
                        <td id="score-${country}" class="score">0</td>
                    `;
                });
            });

            document.querySelectorAll('.medal-input').forEach(input => {
                input.addEventListener('change', function() {
                    const country = this.dataset.country;
                    const medalType = this.dataset.medal;
                    const value = parseInt(this.value) || 0;

                    if (!medalData[country]) {
                        medalData[country] = { gold: 0, silver: 0, bronze: 0 };
                    }
                    medalData[country][medalType] = value;

                    calculateScores();
                });
            });

            calculateScores();
        }

        function calculateScores() {
            const scores = {};

            draftData.forEach(player => {
                scores[player.competitor] = 0;

                player.countries.forEach(country => {
                    const medals = medalData[country] || { gold: 0, silver: 0, bronze: 0 };
                    const totalMedals = medals.gold + medals.silver + medals.bronze;

                    let countryScore = (medals.gold * 5) + (medals.silver * 3) + (medals.bronze * 2);

                    if (totalMedals > 10) {
                        countryScore += 2;
                    }

                    scores[player.competitor] += countryScore;

                    const scoreCell = document.getElementById(`score-${country}`);
                    const totalCell = document.getElementById(`total-${country}`);

                    if (scoreCell) {
                        scoreCell.textContent = countryScore;
                        if (totalMedals > 10) {
                            scoreCell.innerHTML = `${countryScore} <span class="bonus">+2</span>`;
                        }
                    }

                    if (totalCell) {
                        totalCell.textContent = totalMedals;
                    }
                });
            });

            updateLeaderboard(scores);
        }

        function updateLeaderboard(scores) {
            const leaderboard = document.getElementById('leaderboard');
            const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);

            leaderboard.innerHTML = '';

            sortedScores.forEach(([competitor, score], index) => {
                const row = document.createElement('div');
                row.className = 'leaderboard-row';
                if (index === 0) row.classList.add('rank-1');
                if (index === 1) row.classList.add('rank-2');
                if (index === 2) row.classList.add('rank-3');

                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;

                row.innerHTML = `
                    <span class="leaderboard-name">${medal} ${competitor}</span>
                    <span class="leaderboard-score">${score}</span>
                `;

                leaderboard.appendChild(row);
            });
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function hideStatus() {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status hidden';
        }

        async function fetchWikipediaData() {
            const btn = document.getElementById('wikiBtn');
            btn.disabled = true;
            showStatus('üîÑ Fetching data from Wikipedia...', 'loading');

            try {
                // Use allOrigins CORS proxy to fetch Wikipedia page
                const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent('https://en.wikipedia.org/wiki/2026_Winter_Olympics_medal_table'));

                if (!response.ok) {
                    throw new Error('Failed to fetch Wikipedia data');
                }

                const html = await response.text();

                // Parse the HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Find the medal table - it's the first wikitable
                const table = doc.querySelector('table.wikitable');

                if (!table) {
                    throw new Error('Medal table not found on Wikipedia page');
                }

                // Extract medal data from table rows
                const rows = table.querySelectorAll('tbody tr');
                let updatedCount = 0;

                rows.forEach(row => {
                    const cells = row.querySelectorAll('td, th');

                    // Skip header rows or rows without enough cells
                    if (cells.length < 5) return;

                    // Get country name (usually in the second cell, sometimes with a link)
                    const countryCell = cells[1];
                    if (!countryCell) return;

                    let countryName = countryCell.textContent.trim();

                    // Clean up country name (remove extra whitespace, special characters)
                    countryName = countryName.replace(/\s+/g, ' ').replace(/\*/g, '').trim();

                    // Try to match with our draft countries
                    const matchedCountry = findMatchingCountry(countryName);

                    if (matchedCountry) {
                        // Extract medal counts (usually in cells 2, 3, 4)
                        const gold = parseInt(cells[2]?.textContent.trim()) || 0;
                        const silver = parseInt(cells[3]?.textContent.trim()) || 0;
                        const bronze = parseInt(cells[4]?.textContent.trim()) || 0;

                        // Update medal data
                        medalData[matchedCountry] = { gold, silver, bronze };
                        updatedCount++;
                    }
                });

                // Refresh the table with new data
                initializeTable();

                showStatus(`‚úÖ Successfully updated ${updatedCount} countries from Wikipedia!`, 'success');
                setTimeout(hideStatus, 5000);

            } catch (error) {
                console.error('Error fetching Wikipedia data:', error);
                showStatus('‚ùå Error: ' + error.message, 'error');
                setTimeout(hideStatus, 5000);
            } finally {
                btn.disabled = false;
            }
        }

        function findMatchingCountry(wikiCountryName) {
            // Get all unique countries from draft data
            const allCountries = new Set();
            draftData.forEach(player => {
                player.countries.forEach(country => allCountries.add(country));
            });

            // Direct match
            if (allCountries.has(wikiCountryName)) {
                return wikiCountryName;
            }

            // Try common variations
            const variations = {
                'United States': 'USA',
                'United Kingdom': 'Great Britain',
                'Republic of Korea': 'South Korea',
                'Korea': 'South Korea',
                'People\'s Republic of China': 'China',
                'Czech Republic': 'Czech Republic',
                'ROC': 'Individual Neutral Athletes',
                'OAR': 'Individual Neutral Athletes'
            };

            if (variations[wikiCountryName] && allCountries.has(variations[wikiCountryName])) {
                return variations[wikiCountryName];
            }

            // Case-insensitive partial match
            const lowerWiki = wikiCountryName.toLowerCase();
            for (const country of allCountries) {
                if (country.toLowerCase() === lowerWiki) {
                    return country;
                }
            }

            return null;
        }

        initializeTable();
    </script>
</body>
</html>
